---
title: "Classifying IMDB Reviews"
author: "Scott Stoltzman"
date: "7/22/2019"
output: html_document
---

```{r setup, include=FALSE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("tidyverse")
library("tidytext")
library("scales")
library("wordcloud")
library("reshape2")
data("stop_words")
```

# Add cool title up here
#### Action plan, business case, high level summary of results, etc. (all go somewhere up top)

Data is coming from: <https://www.kaggle.com/lakshmi25npathi/imdb-dataset-of-50k-movie-reviews/kernels>

## Exploratory Data Analysis
```{r}
raw_dat = read_csv('IMDB Dataset.csv')
head(raw_dat)
```

```{r}
raw_dat %>%
  unnest_tokens(word, review) %>%
  head()
```


```{r}
dat = raw_dat %>%
  unnest_tokens(word, review) %>%
  anti_join(stop_words)
```


```{r}
dat %>%
  count(word, sort = TRUE)
```


Notice that 'br' was for making a new line `<br>`
```{r}
dat = raw_dat %>%
  unnest_tokens(word, review) %>%
  anti_join(stop_words) %>%
  mutate(word = str_extract(word, "[a-z']+")) %>%
  filter(word != 'br') %>%
  filter(word != 'movie') %>%
  filter(word != 'film')
```


```{r}
dat %>%
  count(word, sort = TRUE) %>%
  summary()
```

```{r}
dat %>%
  count(word, sort = TRUE) %>%
  filter(n > 10000) %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n)) +
  geom_col() +
  xlab(NULL) +
  coord_flip()
```


```{r}
frequency = dat %>% 
  count(sentiment, word) %>%
  group_by(sentiment) %>%
  mutate(proportion = n / sum(n)) %>%
  select(-n) %>%
  spread(sentiment, proportion) 
head(frequency)
```


```{r}
ggplot(frequency, aes(x = negative, y = positive, color = abs(positive - negative))) +
  geom_abline(color = "gray40", lty = 2) +
  geom_jitter(alpha = 0.1, size = 2.5, width = 0.3, height = 0.3) +
  geom_text(aes(label = word), check_overlap = TRUE, vjust = 1.5) +
  scale_x_log10(labels = percent_format()) +
  scale_y_log10(labels = percent_format()) +
  scale_color_gradient(limits = c(0, 0.001), low = "darkslategray4", high = "gray75") +
  theme(legend.position="none") +
  labs(y = "Word", x = NULL)
```


```{r}
cor.test(x = frequency$negative, y = frequency$positive)
```



Sentiment has already been done "per word" in a number of data sets
```{r}
afinn = get_sentiments("afinn")
bing = get_sentiments("bing")
loughran = get_sentiments("loughran")
```


```{r}
sent_dat = dat %>%
  rename(original_sentiment = sentiment) %>%
  left_join(bing, by = 'word') %>%
  rename(bing = sentiment) %>%
  left_join(loughran, by = 'word') %>%
  rename(loughran = sentiment)
head(sent_dat)
```

compare bing...
```{r}
sent_dat %>%
  filter(!is.na(bing)) %>%
  mutate(difference = if_else(original_sentiment == bing, 1, 0)) %>%
  group_by(original_sentiment) %>%
  add_tally() %>%
  summarize(pct_matching = sum(difference) / max(n))
```


matching loughran
```{r}
sent_dat %>%
  filter(!is.na(loughran)) %>%
  mutate(difference = if_else(original_sentiment == loughran, 1, 0)) %>%
  group_by(original_sentiment) %>%
  add_tally() %>%
  summarize(pct_matching = sum(difference) / max(n))
```

```{r}
sent_dat %>%
  group_by(original_sentiment) %>%
  summarize(n = n()) %>%
  ggplot(aes(x = original_sentiment, y = n)) + 
  geom_col()
```


```{r}
sent_dat %>%
  count(word, original_sentiment, sort = TRUE) %>%
  acast(word ~ original_sentiment, value.var = "n", fill = 0) %>%
  comparison.cloud(colors = brewer.pal(8,"Dark2"),
                   max.words = 100)
```

```{r}
sent_dat %>%
  filter(!is.na(bing)) %>%
  count(word, bing, sort = TRUE) %>%
  acast(word ~ bing, value.var = "n", fill = 0) %>%
  comparison.cloud(colors = brewer.pal(8,"Dark2"),
                   max.words = 100)
```







```{r}
sent_dat %>%
  filter(!is.na(loughran)) %>%
  count(word, loughran, sort = TRUE) %>%
  acast(word ~ loughran, value.var = "n", fill = 0) %>%
  comparison.cloud(colors = brewer.pal(8,"Dark2"),
                   max.words = 100)
```

